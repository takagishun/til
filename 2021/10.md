# 10月12日

## Prisma
https://www.prisma.io/docs/guides/database/seed-database
Prismaのseed機能を触ってみた。  
prisma/seed.tsに定義しデータベースの初期データを流し込むことができる。

package.jsonに↓を追記
```json
"prisma": {
  "seed": "ts-node prisma/seed.ts"
},
```
Next.jsを使ってる時は↓
```json
"prisma": {
   "seed": "ts-node --compiler-options {\"module\":\"CommonJS\"} prisma/seed.ts"
},
```

prisma/seed.ts
```typescript
import { PrismaClient } from '@prisma/client'
const prisma = new PrismaClient()

async function main() {
  const alice = await prisma.user.upsert({
    where: { email: 'alice@prisma.io' },
    update: {},
    create: {
      email: 'alice@prisma.io',
      name: 'Alice',
    },
  })
}

main()
  .catch((e) => {
    console.error(e)
    process.exit(1)
  })
  .finally(async () => {
    await prisma.$disconnect()
  })
```

seedを流し込みタイミング
* `prisma migrate reset` or `prisma migrate dev` コマンドを実行した時。 (seedのスキップは--skip-seed)
* 手動で `prisma db seed` を実行した時

## reselect 
https://github.com/reduxjs/reselect  
オブジェクトを返すselectorを別のselectorに渡してもメモ化できるのか検証。  
=> 結論、できる。

index.js
```js
const reselect = require('reselect')

const a = state => state.a
const b = state => state.b

const selector = reselect.createSelector(
  a,
  b,
  (a, b) => {
    console.log('selector')
    return {...a, ...b}
  }
)

const selector2 = reselect.createSelector(selector, a, (selector, a) => {
  console.log('selector2')
  return {...selector, ...a}
})

const selector3 = reselect.createSelector(selector, selector2, (selector, selector2) => {
  console.log('selector3')
  return {...selector, ...selector2}
})

let state = {
  a: {},
  b: {},
  c: {}
}

selector3(state)

selector3({...state, c: {}})
```

2回目のselector3呼出では、各selectorの関数は実行されていない。
```bash
$ node index.js
selector
selector2
selector3
```








# 10月10日

## Prisma

## ドキュメントリーディング
https://www.prisma.io/docs/concepts

### What is Prisma?

PrismaとはObject-relational mapping(ORM)。  
3つにされる構成される。
* Prisma Client: Node.jsとTypeScript用の自動生成されたタイプセーフなクエリビルダー
* Prisma Migrate: Migration system
* Prisma Studio: GUIでデータベースを操作できる

Prisma Clientは、Node.jsとTypescriptのバックエンドアプリケーションに使用する(サーバーレスアプリケーションやマイクロサービスも含む)。  
REST API、GraphQL API、gRPC APIどれでも対応可能。

### How does Prisma work?
Prismaスキーマファイルで、アプリケーションモデルを定義したり、DBコネクションやジェネレターを定義する。  
Prismaスキーマファイルは以下の3つで構成される
* Data source: DB接続を指定
* Generator: Prismaクライアントを生成
* Data model: アプリケーションモデルを定義

#### Prismaデータモデル

データモデルはモデルのコレクションであり、2つの主要な機能がある。
* リレーショナルデータベースのテーブルまたはMongoDBのコレクションを表す
* Prisma ClientAPIでクエリの基盤を提供する

Prismaスキーマにデータモデルを取得するための2つの方法
* Prisma Migrateを使用して、手動でデータモデルを記述して、データベースにマッピングする
* データベースからの内省



