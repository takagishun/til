# 3/9

## API設計

担当しているプロジェクトではSSとFE間のAPI定義にagreed-typedというライブラリを使っている。
プロジェクトの振り返り会でそのAPI定義だとSSエンジニアが理解しづらいという話が上がり、別途スプレッドシートなどに起こした方が良いのではという話になった。
2重管理は避けたいし、FEとしてはagreed-typedが使い慣れているのでそれでAPIを管理したいという気持ち。
SSとしてはどこが具体的に理解しづらいかが深ぼれできてなかったので、一旦持ち帰りとなった。
この手の話は、結構いろんなとこで話題に上がるが、API定義の一番よき方法ってなんだろうと考えるきっかけになった。

FEとしてAPI定義書に書いてて欲しいもの
- URL
- method
- クエリやbodyの型
  - 必須か任意か
  - 数値か文字列かなど
- 正常系のレスポンス
- 異常系のレスポンス
  - あくまでユースケースとして存在するもののみ

SS側で必要なものはFEのものより多そうだなとは思った

# 3/8

## Web ブラウザセキュリティ

- CORS以外のリソース共有(※どちらも脆弱性を埋め込む可能性あるので基本利用しない)
  - Web APIのpostMessageを利用する
  - document.domainを利用する
- CORSは異なるオリジン間のリソースを守るのには有効
- 同一オリジンでのリソースの制限はないので、Content Injection脆弱性が生まれる可能性がある
- Content Injection脆弱性の対策ではContent Security Policyを利用する

# 3/7

## Web ブラウザセキュリティ

- SOP があると安全だが、不便の場合もある。Origin が違う API からデーターを取得したいケースなど。
- SOP によりブロックされるアクセスを、リソース提供者が許可する仕組みが Cross-Origin Resource Sharing
  - Cross-Origin なリソースへのブラウザ内アクセスの許可
  - Cross-Origin なリソースへのリクエストの許可
- Cross-Origin なリソースへのブラウザ内アクセスの許可方法
  - Access-Control-Allow-Origin ヘッダーに許可する Origin 名 か \* を指定する
  - Cookie を含めたリクエストの場合はレスポンスに以下を含む必要あり
    - Access-Control-Allow-Origin ヘッダーに許可する Origin 名
    - Access-Control-Allow-Credentials: true
- Cross-Origin なリソースへのリクエストの許可方法
  - プリフライトリクエストのレスポンスが以下を満たす場合
    - Access-Control-Allow-Origin ヘッダにリクエ スト発行元の Origin を含んでいる
    - Access-Control-Allow-Methods ヘッダの値に発行しようとしているリクエストのメソッドを含んでいる
    - Access-Control-Allow-Headers ヘッダに発行しようとしているリクエストのヘッダーを全て含んでいる
    - Access-Control-Max-Age ヘッダを付与することでプリリクエストのレスポンス結果をキャッシュできる

# 3/6

## Web ブラウザセキュリティ

- 各 URL に対する Origin は、(スキーム, ホスト名, ポート番号)の 3 つ組として定義される値
  - https://datatracker.ietf.org/doc/html/rfc6454
- Origin が同じ場合は Same-Origin、異なる場合は Cross-Origin
- Cross-Origin のリソースにアクセスできる方法を制限するセキュリティ機構のことを SOP(Same-Origin Policy)という

SOP(Same-Origin Policy) メトリクス

<table>
<tr><td>Same-Origin</td><td>ブラウザ内アクセス</td><td>制限しない</td></tr>
<tr><td>Same-Origin</td><td>ネットワークアクセス</td><td>制限しない</td></tr>
<tr><td>Same-Origin</td><td>埋め込み</td><td>制限しない</td></tr>
<tr><td>Cross-Origin</td><td>ブラウザ内アクセス</td><td>ほぼ禁止</td></tr>
<tr><td>Cross-Origin</td><td>ネットワークアクセス</td><td>部分的に禁止※1</td></tr>
<tr><td>Cross-Origin</td><td>埋め込み</td><td>制限しない</td></tr>
</table>

※1: img タグや form タグの場合は許容。fetch を利用したアクセスなどは禁止

# 3/5

## Web ブラウザセキュリティ

- fe がブラウザのセキュリティについて考慮すべきこと
  - ブラウザが担保しようとしているセキュリティを理解すること
  - ブラウザのセキュリティ機構を適切に利用すること
- ブラウザセキュリティの関心毎はリソース間の隔離をいかに達成するか
- ブラウザセキュリティの関心事は以下の 4 つの問題に分類できる
  1. リソース間の論理的な隔離をどう達成するか
  2. リソース間のプロセスレベルの隔離をどう達成するか
  3. Cookie をどうセキュアに取り扱うか
  4. 出入りするリソースの信頼性をどう確保するか
