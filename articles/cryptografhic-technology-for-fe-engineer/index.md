# TLSで学ぶ暗号技術

## 情報セキュリティーと暗号技術

情報セキュリティとは、情報の機密性、安全性、及び可用性を維持すること。さらに真正性、責任追跡性、否認防止、信頼性などの特性を維持することを含めることもある。  
暗号技術とは、暗号化、復号、認証、MAC(メッセージ認証コード)、ハッシュ、署名、鍵共有などを総称したものである。  
情報セキュリティの中でも、機密性、安全性、真正性を満たすために暗号技術が利用される。

<table>
<tr>
<td>機密性</td>
<td>認可した人以外はアクセスできない事。秘匿性。</td>
</tr>
<tr>
<td>安全性</td>
<td>データは改竄や削除がされていない事。</td>
</tr>
<tr>
<td>真正性</td>
<td>その人が本物であること。</td>
</tr>
</table>

## TLSの概要

- 安全でないインフラ上で安全に通信するためのセキュリティプロトコル
- 盗聴、改ざん、メッセージの偽造を防止するように設計された方法で通信できる
- アプリケーション層のデータを分割し、データを保護してトランスポート層に転送する

<table>
<tr>
<th>階層名</th>
<th>説明</th>
<th>プロトコル</th>
</tr>
<tr>
<td>アプリケーション層</td>
<td>アプリケーションデータを扱う</td>
<td>HTTP</td>
</tr>
<tr>
<td>プレゼンテーション層</td>
<td>データの表現、変換、暗号化を扱う</td>
<td>SSL/TLS</td>
</tr>
<tr>
<td>セッション層</td>
<td>複数のコネクションを管理</td>
<td>-</td>
</tr>
<tr>
<td>トランスポート層</td>
<td>データ通信の制御</td>
<td>TCP</td>
</tr>
<tr>
<td>ネットワーク層</td>
<td>インターネットワークでの通信</td>
<td>IP</td>
</tr>
<tr>
<td>データリンク層</td>
<td>ローカルなデータリンクにおける通信(LAN)</td>
<td>Ethernet</td>
</tr>
<tr>
<td>物理層</td>
<td>物理的なデータのやり取り(ケーブル)</td>
<td>CAT5</td>
</tr>
</table>

<img src="./secure-transport.png" width="564" alt="セキュアな通信">

## TLSのプロトコル

アプリケーション層とトランスポート層間のデータの転送を行うプロトコル。いくつかの Layer に分けられる。
TLS Recordプロトコルは、さまざまな上位プロトコルのカプセル化に使用され、上位プロトコルとしてハンドシェイクプロトコル、アラートプロトコル、暗号仕様変更プロトコル、アプリケーションデータプロトコルが定義されている、。

### 分割レイヤー

- レコードサイズが 16384 バイトに収まるようにデータを分割し、一つのレコードを作成する
- 各レコードのヘッダーにコンテントタイプ、プロトコルのバージョン、レコード長、ペイロードに分割したアプリケーションデータが格納される

### 暗号化レイヤー

- ペイロードにメッセージ認証符号(以下、MAC)を付与し、それをハンドシェイク時に合意した暗号化方式で暗号化する
- ハンドシェイクの最初の一連のメッセージは暗号化はされない

## TLS ハンドシェイクプロトコル

Handshakeプロトコルのメッセージの先頭にはヘッダがある。このヘッダで メッセージの種類(1バイトで記述される)とメッセージの長さ(3バイトで記述される)を表す。
サーバ認証を伴うフルハンドシェイクを紹介する
図を挿入



# TLSの限界

アプリケーションデータを通信する前に、まずはクライアントとサーバー間で安全な通信を確立します。その一連のやりとりをハンドシェイクといいます。


#RFC

TLS1.2: https://datatracker.ietf.org/doc/html/rfc5246
TLS1.3: https://datatracker.ietf.org/doc/html/rfc8446







